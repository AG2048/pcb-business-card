# PCB Business Card Development Procedures and Resources
This document provides the documentation and resources for my PCB business card project.

An overview of the project's major components discusses the research and considerations made for the Qi charging, NFC tag, processor, and LED matrix. 

This document then describes the creation and testing of the Qi and NFC test board prior to the V1 board. 

The V1 board design and improvements based on the test board are then discussed, as well as the software development involved to drive the display and read data wirelessly transmitted to the NFC tag. 

## Individual Components Research
The PCB business card consists of several key components / features. This section describes the research, design process, and resources for each component.

### Qi Charging
The first feature I wanted to implement on the PCB business card is a way to wirelessly charge the card using a coil etched on the PCB itself. 

Before any design was made, I was facing two possible choices:
1. Make a PCB that is mostly designed for the look and aethetics of a business card, where copper traces and exposed copper areas are used to form patterns and shapes that does not have a lot of (if any) functional purpose. A card like this would obviously look very nice, but it may not be functional and therefore may not be able to demonstrate my skills / capabilities as a computer / electrical engineer. 
2. Make a PCB that is functional and can be an electronic display to the user using actuators (data processing PCBs are not very interesting to look at, and the tools / devices used to drive such data processors can be hard to demonstrate outside of a familiar environment). This would allow me to demonstrate and develop my PCB design skills, but could make the board less visually appealing.

I ended up choosing the second option, since I wanted something that is functional, instead of just being a pretty piece of fibre / copper. 

From what I have seen in other PCB business cards that can be found online, most of them require wired power / signal transmission to the business card (if those business card is functional at all). However, any type of connector would inevitably make the card thicker, while exposed 5V/GND wires and pads would mean that I have to carry a specific DC power supply that can supply power to wires and then onto the card. 

With those considerations in mind, I decided that a wireless power solution using PCB coils would be the best idea. It would look nice and unique (PCB coils are not very common overall), maintain a thin profile for the card (no additional connectors are needed to power the card, the coil would also have to be etched on the PCB itself, as any external coils would add to the card's thickness), and it is overall a new and interesting design I have not worked on before.

#### Existing Wireless Power PCBs
Doing some research online, I came across a YouTube video that designed a simple wireless power transfer PCB using two boards with PCB coils. 

[How to make Wireless Power Transmitter With printed Coil on the PCB](https://youtu.be/3QEGdm6vfUw?si=p93Ei830A4B2cbgJ)

The design is simple. It involves a source PCB with an LC circuit that is driven on and off by a 555 timer, which generates a square wave that is then transmitted to the receiver PCB with a corresponding LC circuit. The receiver can then connect the LC circuit to a rectifier to convert the AC signal in the coils back to DC, which can then be used to power a load.

In this video, the key is to tune the inductance and the capacitance of the LC circuits such that their resonant frequency matches the frequency of the switching network (generated by the 555 timer). This allows efficient power transfer, or else the receiver may not receive enough power to drive the load. However, this video also showed that the inductance of the PCB coils should be determined after the PCB is manufactured, and any capacitors should be selected accordingly after measuring the PCB coils' inductance. This can become challenging as I intend to use only SMD components on the PCB to keep it thin, and it would be difficult to predict what combination of capacitors (series / parallel) would be needed to match the resonant frequency of the PCB coils, meaning that I cannot produce a fully functional board before finding out what capacitance is needed. Furthermore, the PCB manufacturer I was using (JLCPCB) is located in China, which means that I would have to wait a long time and pay for shipping just for an early prototype of the wireless power module. 

This video provided me a good foundation and understanding of wireless power using PCB coils, and proved that this idea is, at minimum, possible. However, it is also mentioned that this form of power transfer is not very efficient, and specific protocols might be needed to send sufficient power to the receiver. Additionally, this design does not solve my initial concern of requiring a specific DC power supply, it simply shifted the problem from the PCB card itself to a separate PCB that is used as the transmitter. I hope that I can charge / power the PCB business card with a standard wireless charger that is relatively common nowadays for smartphones, so that I can provide power to the card using any wireless charger, and that other people who receives my card can also charge / power the card using their own wireless chargers.

#### Qi Wireless Charging
From my knowledge, a popular wireless charging standard is the Qi standard, and thus I began looking into how Qi wireless charging works, and if it is possible to implement this protocol on a small PCB. 

The first resource I found is this blog: [Qi wireless power receiver from scratch](https://blog.vinu.co.in/2019/04/qi-wireless-power-receiver-from-scratch.html). This blog outlines the basic principles of the Qi wireless charging protocol (did you know that Qi allows communications between the transmitter and the receiver in binary?) and provides a simple implementation of a Qi receiver driven by an ATTiny13A microcontroller. This implementation is very simple, as from reading the [source code](https://github.com/vinodstanur/qi_wireless_receiver_attiny13), it only pings the transmitter once receiving power, and then periodically request more or less power based on an analog pin input. Even though the implementation is simple, it is still a good starting point for me to understand how the Qi protocol works and how I can implement it myself on my PCB. 

After reading the blog, I went to the WPC (Wireless Power Consortium) website to read the official Qi specification. As it turned out, there's much more communication and specifications that a proper Qi receiver needs to implement. Therefore, I gave up trying to implement my own Qi receiver, and instead looked for existing power receiver ICs that I can use to drive the Qi receiver, while I still design the PCB coil myself. (From reading the Qi specification, I have set my initial target coil size to around 4 cm in diameter, since that is the recommended size mentioned for a Qi receiver)

#### Wireless Charger Design
- Looking for chip (that can be PCBA by JLC)
- Understanding L and L' values
- Online PCB coil calculators.
- Q factor matching -- custom Desmos script
  - Here considering between 1 oz vs 2 oz copper, which reduces R so boosts Q...
  - Cost issue...
  - manufacturer minimum spacing
  - Surprisingly, decreasing L but replacing to MUCH thicker traces can increase Q.
  - Single vs double layer coil -- mutual inductance calculation. (paper)
- I cannot personally test the board, left footprints for any 3C combination of caps. Also left TPs for through hole caps / wires. 
(More details in the Qi and NFC Test Board section)

### NFC Tag
- Initially I wanted to drive the LEDs using the microcontroller itself, with shift registers to read signals from the microprocessor's limited pins, and do a "row by row" scan of the LED matrix to basically display the whole matrix with a 1/N duty cycle.  
- To use the limited pins on microprocessors, I thought about using an 8-bit data output EEPROM that can read an address stored on shift register, and display corresponding "column pattern" when the corresponding row is turned on. 
- Through my search, I found EEPROMs that uses I2C to read / write data. This is not very ideal with my initial design, since it would require multiple cycles to let the module output data, and the data is shown through the I2C bus instead of the parallel bus I was looking for. But this gave me an idea to use such EEPROM to temporarily load patterns onto the chip memory, and "shift" the data out to the LED matrix in a "longer" shift register chain that handles both rows and columns. 
- At this point, I had planned 2 pins for Shift register control and 2 for I2C. But clearly the initial ATTiny10 idea doesn't have enough pins for this. Had to compromise by also shifting the I2C "clock" signal through shift registers, only leaving the SDA pin as an IO pin directly to the processor... Clearly, this isn't a great solution...
- While looking for inspirations from existing PCB business cards, I found that a lot of cards have NFC tags that can display their websites when tapped by a phone. I then realized through some search of existing NFC tag chips that a lot of such NFC tags have large user memory areas that can double as a data storage EEPROM for the LED matrix. Better yet, they are also I2C compatible. 
- Another benefit on top of that is that these NFC tags can be written to by a phone. So in this case, as long as the microcontroller's program can read the NFC tag's user memory, I can remotely update any display patterns on the card. This would be a great addition to the card, since not only it is "cool" (as in it's wireless), it is also very convenient and practical, since if I had used a regular EEPROM, any pattern change would require some wired re-programming of the EEPROM. But now I can just tap my phone on it with the images (although it has to be formatted correctly) and everything is done. 

- Go into coil design -- the NFC tag has a standard built-in capacitance. Therefore only the inductor coil needs to be designed. However, I'm personally worried about the coil being next to wireless power (the Qi charger). So according to ST's recommendations, I added a seires 1nF capacitor to act as a high-pass filter to block the 100kHz Qi signal, while allowing the NFC tag's 13.56 MHz signal to pass through.
- Also from some development recommendations, I made the coils' inductances SLIGHTLY smaller than what's needed -- so it can be compendated by adding parallel capacitors to tune the resonant frequency -- while reducing the capacitance may need more work. 

### Processor
- Was previously working with ATTiny10 on some other projects
- Realized ATTinys are pretty good processors for small projects. 
- Initially considered ATTiny10, but it doesn't have enough RAM and pins for an initial shift register type LED matrix. 
- Thought about ATTiny20, but there's not a lot of support / resources online for programming / programmer...
- Switched to the more popular ATTiny84. It has enough pins (enough to support my initial shifting register LED matrix design). It has enough memory (512 B is a lot for my application -- at least when every pixel is just 1 bit). 

### LED Matrix
- Hoped for a 8x16 matrix, arranged like the Arduino Uno R4 matrix.
- Alluded to before, thought of a matrix similar to that of Arduino Uno R4. I don't want to deal with charlieplexing. So I thought about a row by row scanning...
- Found some TI shift registers (open drain and push-pull / 3 state...) that can be used. 
- However, after finding some existing PCB business card with LED matrix, I realized that I could just use a small 1mm x 1mm addressable RGB LED matrix. (I initially thought about addressible LEDs, but my early searches all ended up with those LARGE LEDs, so I kinda gave up too early on that)
- Since in this case, I would like JLC to handle the PCB assembly. I found the closest one on their website with is a 1.5mm x 1.5mm LED, which is unfortunate that I can only fit 6x12 of those on the PCB. Additionally, those LEDs only need 1 pin to drive. 
- I was initially scared by their recommendations on the datasheet that EVERY LED should have its own capacitor between VCC and GND (not enough space...)... But later I realized it's probably fine as long as the power is stable / there's enough capacitors close enough between multiple LEDs.
- In V2 board, I found some alternative 1mm x 1mm LEDs that are also cheaper. So hopefully I can fit an 8x16 matrix on the V2 board. Honestly 8x12 also looks fine.
- Was worried about power consumptions. But from V1 board tests, full brightness is TOO bright, so running only at 1/16 brightness. (The power can barely support 72 LEDs' at full brightness, but 1/16 brightness is definitely fine... So I think expanding to 8x16 is ok on the power side.)

## Qi and NFC Test Board

## V1 Board